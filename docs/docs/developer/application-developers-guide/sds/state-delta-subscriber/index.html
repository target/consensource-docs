<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.59.1" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/consensource-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/consensource-docs/favicons/android-192x192.png" sizes="192x192">

<title>State Delta Subscriber | ConsenSource Docs</title><meta property="og:title" content="State Delta Subscriber" />
<meta property="og:description" content="Overview and examples of the ConsenSource State Delta Subscriber
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://target.github.io/consensource-docs/docs/developer/application-developers-guide/sds/state-delta-subscriber/" />
<meta property="article:modified_time" content="2019-12-16T14:41:28-06:00" />
<meta itemprop="name" content="State Delta Subscriber">
<meta itemprop="description" content="Overview and examples of the ConsenSource State Delta Subscriber
">


<meta itemprop="dateModified" content="2019-12-16T14:41:28-06:00" />
<meta itemprop="wordCount" content="419">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="State Delta Subscriber"/>
<meta name="twitter:description" content="Overview and examples of the ConsenSource State Delta Subscriber
"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-158864115-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<link rel="preload" href="/consensource-docs/scss/main.min.5649880a78e700ae33d531bb1afa4bc299a8eff1f4647c46c256bd59d1fb25c4.css" as="style">
<link href="/consensource-docs/scss/main.min.5649880a78e700ae33d531bb1afa4bc299a8eff1f4647c46c256bd59d1fb25c4.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>




    <title>State Delta Subscriber | ConsenSource Docs</title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/consensource-docs/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">ConsenSource Docs</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/consensource-docs/about/" ><span>About</span></a>
			</li>
            
            <li class="nav-item dropdown d-none d-lg-block">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Documentation (WIP)
    </a>
    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
        <a class="dropdown-item" href="/consensource-docs/docs/business">Business</a>
        <a class="dropdown-item" href="/consensource-docs/docs/developer">Developer</a>
    </div>
    
            </li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="consensource-docs-docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/business/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Business</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-business">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-business-context-problem-statement" href="/consensource-docs/docs/business/context-problem-statement/">Context and Problem Statement</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-business-value-proposition" href="/consensource-docs/docs/business/value-proposition/">Value Proposition</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-business-dlt-overview" href="/consensource-docs/docs/business/dlt-overview/">Distributed Ledger Technology (DLT) Overview</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Developer</a>
  </li>
  <ul>
    <li class="collapse show" id="consensource-docs-docs-developer">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/getting-started/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-getting-started">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/getting-started/local/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Running ConsenSource Locally</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-getting-started-local">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-getting-started-local-mac" href="/consensource-docs/docs/developer/getting-started/local/mac/">macOS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-getting-started-local-windows" href="/consensource-docs/docs/developer/getting-started/local/windows/">Windows</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-getting-started-local-linux" href="/consensource-docs/docs/developer/getting-started/local/linux/">Linux</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-getting-started-gcp-gcp" href="/consensource-docs/docs/developer/getting-started/gcp/gcp/">Running ConsenSource In GCP</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Application Developer&#39;s Guide</a>
  </li>
  <ul>
    <li class="collapse show" id="consensource-docs-docs-developer-application-developers-guide">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/architecture-overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Architecture Overview</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-architecture-overview">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-application-developers-guide-cli-cli" href="/consensource-docs/docs/developer/application-developers-guide/cli/cli/">CLI</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-application-developers-guide-api-rest-api" href="/consensource-docs/docs/developer/application-developers-guide/api/rest-api/">API</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/client/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Client</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-client">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/client/retailer/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Retailer View</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-client-retailer">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/client/factory/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Factory View</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-client-factory">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/client/certifying-body/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Certifying View</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-client-certifying-body">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/application-developers-guide/client/standards-body/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Standards Body View</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-application-developers-guide-client-standards-body">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-consensource-docs-docs-developer-application-developers-guide-sds-state-delta-subscriber" href="/consensource-docs/docs/developer/application-developers-guide/sds/state-delta-subscriber/">State Delta Subscriber</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-application-developers-guide-tp-transaction-processor-and-famlies" href="/consensource-docs/docs/developer/application-developers-guide/tp/transaction-processor-and-famlies/">Transaction Processor &amp; Families</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/terminology/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Terminology</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-terminology">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/troubleshooting/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Troubleshooting</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-troubleshooting">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/consensource-docs/docs/developer/community/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Community</a>
  </li>
  <ul>
    <li class="collapse " id="consensource-docs-docs-developer-community">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-consensource-docs-docs-developer-parameter-reference" href="/consensource-docs/docs/developer/parameter-reference/">Parameter Reference</a>
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/target/consensource-docs/edit/master/content/en/docs/developer/Application%20Developer%27s%20Guide/SDS/state-delta-subscriber.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/target/consensource-docs/issues/new?title=State%20Delta%20Subscriber" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>

</div>






<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#reporting-database-structure">Reporting Database Structure</a></li>
<li><a href="#fork-resolution">Fork resolution</a></li>
</ul></li>
</ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		













<li class="breadcrumb-item" >
	<a href="https://target.github.io/consensource-docs/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://target.github.io/consensource-docs/docs/developer/">Developer</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://target.github.io/consensource-docs/docs/developer/application-developers-guide/">Application Developer&#39;s Guide</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://target.github.io/consensource-docs/docs/developer/application-developers-guide/sds/state-delta-subscriber/">State Delta Subscriber</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>State Delta Subscriber</h1>
	<div class="lead">Overview and examples of the ConsenSource State Delta Subscriber</div>
	



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">GitHub Link</h4>
<a href="https://github.com/target/consensource/tree/master/state_delta_subscriber" target="_blank">https://github.com/target/consensource/tree/master/state_delta_subscriber</a>
</div>


<p>The goal of State Delta Export is to provide a mechanism for exporting on-chain state values from a validator to an external data store. This allows applications to efficiently query their state values. The state delta export implements an event subscription client that subscribes to block commit events and Sawtooth state delta at specific addresses (in this case we will subscribe to all state delta events at the Certificate Registry namespace). Sawtooth sends these events whenever the validator’s state is updated. The events contain the raw state data at the updated addresses. The event subscription client processes the event data and uses it to update the reporting database, an off-chain copy of blockchain state. The REST API can query this database when a client needs to get information from the blockchain.</p>

<p>This off-chain state access comes at the expense of relying on a single validator for state updates, this puts the application at risk of having stale data or forked state if the validator supplying the state updates comes out of consensus or is disconnected from the network. Below are guidelines on how to structure the reporting DB so fork resolution is easy.</p>

<h2 id="reporting-database-structure">Reporting Database Structure</h2>

<p><img src="https://github.com/target/consensource-docs/blob/master/content/docs/developer/Application%20Developer's%20Guide/SDS/ConsenSource_DBSchema.png?raw=true" alt="DB Schema" /></p>

<p>The reporting DB has three types of tables: sawtooth-core tables (Blocks), domain-specific state tables (Agents, Organizations, Authorizations, Certificates, CertificateData), and application tables (tables supporting off-chain application components, such as Auth, in the schema above).
The reporting DB should follow the <a href="https://en.wikipedia.org/wiki/Slowly_changing_dimension#Type_2:_add_new_row" target="_blank">Type 2 of Slowly Changing Dimensions</a> data management pattern, so that fork resolution is easy.</p>

<p>For use in a State Delta Export, a state table includes additional columns of start_block_num and end_block_num. The ​start_block_num​ and ​end_block_num​ columns specify the block range in which that state value is set or exists. Values that are valid as of the current block have ​end_block_num​ set to MAX_UINT_64.</p>

<p>Because there might be state objects in the database that refer to the same object in state at different block heights (with different block numbers), the primary key for each object cannot be the same as the object’s natural key in blockchain state. Instead, use a sequence ID column or another unique ID scheme as the primary key. For better query performance, we recommend creating indexes on the natural key of the entry and the end_block_num.</p>

<h2 id="fork-resolution">Fork resolution</h2>

<p>The following pseudocode demonstrates the fork resolution process:</p>

<pre><code>resolve_fork(existing_block):
  for table in domain_tables:						
    delete from table where start_block_num &gt;= existing_block.block_num
    update table set end_block_num = MAX_UINT_64 \					
      where end_block_num &gt;= existing_block.block_num
  delete from block where block_num &gt;= existing_block.block_num
</code></pre>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/target/consensource/issues/new/choose">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/target/consensource/issues/new/choose">tell us how we can improve</a>.
</p>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified December 16, 2019: <a  href="https://github.com/target/consensource-docs/commit/baeff0c4aadf051107f1e959594c6b2a1c199390">Update business docs (baeff0c)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2020 Target Brands All Rights Reserved</small>
        <small class="ml-1"><a href="https://github.com/target/consensource/blob/master/LICENSE" target="_blank">Privacy Policy</a></small>
	
		<p class="mt-2"><a href="/consensource-docs/about/">About ConsenSource</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/consensource-docs/js/main.min.cdd91a44697531d15efad5e3d5ac75f32e229c1434b8ed88a2fefbc45c5fd440.js" integrity="sha256-zdkaRGl1MdFe&#43;tXj1ax18y4inBQ0uO2Iov77xFxf1EA=" crossorigin="anonymous"></script>





  </body>
</html>